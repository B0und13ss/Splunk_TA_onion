[zeek:json]
SHOULD_LINEMERGE        = false
LINE_BREAKER            = ([\r\n]+)
TIME_PREFIX             = \{\"ts\"\:
MAX_TIMESTAMP_LOOKAHEAD = 17
INDEXED_EXTRACTIONS     = json
KV_MODE                 = none
AUTO_KV_JSON            = false
TRUNCATE                = 0

[zeek:json]
FIELDALIAS-app        = service ASNEW app
FIELDALIAS-dest_mac   = resp_l2_addr AS dest_mac
FIELDALIAS-id.orig_h  = id.orig_h ASNEW src id.orig_h ASNEW src_ip
FIELDALIAS-id.orig_p  = id.orig_p ASNEW src_port
FIELDALIAS-id.resp_h  = id.resp_h ASNEW dest id.resp_h ASNEW dest_ip
FIELDALIAS-id.resp_p  = id.resp_p ASNEW dest_port
FIELDALIAS-src_mac    = orig_l2_addr AS src_mac
FIELDALIAS-ts         = ts AS timestamp
FIELDALIAS-uid        = uid AS flow_id uid AS session_id

[source::/nsm/zeek/logs/current/conn.log]
LOOKUP-conn_history   = conn_history history_letter OUTPUTNEW history_meaning tcp_flag tcp_session_source
LOOKUP-conn_state     = conn_state conn_state OUTPUTNEW action, conn_state_meaning AS connection_state_description
FIELDALIAS-orig_bytes = orig_ip_bytes ASNEW bytes_out
FIELDALIAS-resp_bytes = resp_ip_bytes ASNEW bytes_in
FIELDALIAS-orig_pkts  = orig_pkts ASNEW packets_out
FIELDALIAS-resp_pkts  = resp_pkts ASNEW packets_in
EVAL-direction        = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product          = "Zeek"
EVAL-sensor_name      = coalesce(system_name, host, "unknown")
EVAL-transport        = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product   = "Zeek"
EVAL-bytes            = tonumber(bytes_out) + tonumber(bytes_in)
EVAL-packets          = tonumber(packets_out) + tonumber(packets_in)
EVAL-history_letter   = split(history,"")

[source::/nsm/zeek/logs/current/dns.log]
FIELDALIAS-qtype      = qtype ASNEW query_type_id
FIELDALIAS-rcode      = rcode ASNEW reply_code_id
FIELDALIAS-qtype_name = qtype_name ASNEW record_type
FIELDALIAS-rcode_name = rcode_name ASNEW reply_code
FIELDALIAS-trans_id   = trans_id ASNEW transaction_id
FIELDALIAS-rtt        = rtt ASNEW duration rtt ASNEW response_time
FIELDALIAS-answer     = answers{} ASNEW answer answers ASNEW answer
EVAL-direction        = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product          = "Zeek"
EVAL-sensor_name      = coalesce(system_name, host, "unknown")
EVAL-transport        = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product   = "Zeek"
EVAL-answer_count     = mvcount(answer)
EVAL-query_count      = mvcount(query)
EVAL-query_length     = len(query)
EVAL-answer_length    = len(answer)
EVAL-message_type     = if(isnotnull(rcode),"Response","Query")

[source::/nsm/zeek/logs/current/http.log]
FIELDALIAS-status_code       = status_code ASNEW status
FIELDALIAS-referrer          = referrer ASNEW http_referrer
FIELDALIAS-user_agent        = user_agent ASNEW http_user_agent
FIELDALIAS-username          = username ASNEW user
FIELDALIAS-uri               = uri ASNEW uri_path
FIELDALIAS-method            = method ASNEW http_method
FIELDALIAS-request_body_len  = request_body_len ASNEW bytes_out
FIELDALIAS-response_body_len = response_body_len ASNEW bytes_in
FIELDALIAS-resp_fuids        = resp_fuids ASNEW file_id
EVAL-direction               = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product                 = "Zeek"
EVAL-sensor_name             = coalesce(system_name, host, "unknown")
EVAL-transport               = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product          = "Zeek"
EVAL-http_user_agent_length  = len(http_user_agent)
EVAL-bytes                   = if(isnum(bytes),bytes,bytes_in+bytes_out)
EVAL-url                     = extracted_host . uri
EVAL-url_length              = len(extracted_host . uri)
EVAL-uri_query               = mvjoin(mvindex(split(uri,"?"),1, -1), "?")

[source::/nsm/zeek/logs/current/ocsp.log]
FIELDALIAS-serialNumber = serialNumber ASNEW ssl_serial
EVAL-direction          = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product            = "Zeek"
EVAL-sensor_name        = coalesce(system_name, host, "unknown")
EVAL-transport          = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product     = "Zeek"

[source::/nsm/zeek/logs/current/files.log]
FIELDALIAS-fuid           = fuid ASNEW file_id
FIELDALIAS-name           = filename ASNEW file_name
FIELDALIAS-path           = path ASNEW file_path
FIELDALIAS-size           = seen_bytes ASNEW file_size
FIELDALIAS-times_accessed = times_accessed ASNEW file_access_time
FIELDALIAS-times_modified = times_modified ASNEW file_modify_time
FIELDALIAS-times_created  = times_created ASNEW file_create_time
EVAL-direction            = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product              = "Zeek"
EVAL-sensor_name          = coalesce(system_name, host, "unknown")
EVAL-transport            = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product       = "Zeek"
EVAL-file_hash            = case(sha256!="-", sha256, sha1!="-",sha1,md5!="-",md5,true(),"-")

[source::/nsm/zeek/logs/current/ftp.log]
FIELDALIAS-reply_msg  = reply_msg AS signature
FIELDALIAS-reply_code = reply_code AS signature_id
EVAL-direction        = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product          = "Zeek"
EVAL-sensor_name      = coalesce(system_name, host, "unknown")
EVAL-transport        = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product   = "Zeek"
EVAL-action           = case(signature_id<300,"success",signature_id>=300,"failure")

[source::/nsm/zeek/logs/current/ssl.log]
LOOKUP-ssl_history           = ssl_history ssl_history_letter OUTPUTNEW history_meaning ssl_source
FIELDALIAS-ssl_version       = version ASNEW ssl_version
FIELDALIAS-issuer            = issuer AS ssl_issuer
FIELDALIAS-subject           = subject AS ssl_subject
FIELDALIAS-server_name       = server_name AS ssl_subject_common_name
FIELDALIAS-cipher            = cipher AS ssl_cipher
FIELDALIAS-curve             = curve AS ssl_curve
FIELDALIAS-validation_status = validation_status AS signature
EVAL-direction               = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product                 = "Zeek"
EVAL-sensor_name             = coalesce(system_name, host, "unknown")
EVAL-transport               = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product          = "Zeek"
EVAL-ssl_history_letter      = split(ssl_history,"")
EVAL-action                  = case(established=="true","success",established =="false","failure")

[source::/nsm/zeek/logs/current/x509.log]
FIELDALIAS-certificate_version          = certificate_version ASNEW ssl_version
FIELDALIAS-certificate_serial           = certificate_serial ASNEW ssl_serial
FIELDALIAS-certificate_not_valid_before = certificate_not_valid_before ASNEW ssl_start_time
FIELDALIAS-certificate_not_valid_after  = certificate_not_valid_after ASNEW ssl_end_time
FIELDALIAS-certificate_issuer           = certificate_issuer ASNEW ssl_issuer
FIELDALIAS-certificate_key_alg          = certificate_key_alg ASNEW ssl_publickey_algorithm
FIELDALIAS-L                            = L ASNEW ssl_subject_locality
FIELDALIAS-C                            = C ASNEW ssl_subject_country
FIELDALIAS-ST                           = ST ASNEW ssl_subject_state
FIELDALIAS-O                            = O ASNEW ssl_subject_organization
FIELDALIAS-certificate_sig_alg          = certificate_sig_alg ASNEW ssl_signature_algorithm
FIELDALIAS-certificate_subject          = certificate_subject ASNEW ssl_subject
FIELDALIAS-fingerprint                  = fingerprint ASNEW ssl_hash
FIELDALIAS-san_email                    = san_email ASNEW ssl_subject_email
EVAL-direction                          = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product                            = "Zeek"
EVAL-sensor_name                        = coalesce(system_name, host, "unknown")
EVAL-transport                          = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product                     = "Zeek"
EVAL-ssl_issuer_common_name             = replace(mvindex(split(ssl_issuer,","),0), "CN=","")
EVAL-ssl_subject_common_name            = replace(mvindex(split(certificate_subject,","),0), "CN=","")
EVAL-ssl_subject_email_domain           = mvindex(split(ssl_subject_email, "@"),1)
EVAL-ssl_validity_window                = ssl_end_time - ssl_start_time
EVAL-ssl_is_valid                       = if(tonumber(ssl_end_time) >= now() and tonumber(ssl_start_time) <= now(),"true", "false")

[source::/nsm/zeek/logs/current/smtp.log]
FIELDALIAS-urls      = urls{} as url
FIELDALIAS-domains   = domains{} AS url_domain
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/ssh.log]
FIELDALIAS-client    = client ASNEW user_agent
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"
EVAL-action          = case(auth_success="T" and auth_attempts!="-","success",auth_success="F" and auth_attempts!="-", "failure")

[source::/nsm/zeek/logs/current/pe.log]
FIELDALIAS-subsystem = subsystem AS parent_process_name
FIELDALIAS-machine   = machine AS parent_process_id
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/dhcp.log]
FIELDALIAS-client_fqdn = client_fqdn AS dest_dns client_fqdn AS src_dns
FIELDALIAS-server_addr = server_addr ASNEW dest_ip
FIELDALIAS-mac         = mac ASNEW dest_mac
FIELDALIAS-host_name   = host_name ASNEW src_host host_name ASNEW dest_nt_host
FIELDALIAS-client_addr = client_addr ASNEW src_ip
FIELDALIAS-uids        = uids ASNEW flow_id uids ASNEW session_id uids{} ASNEW flow_id uids{} ASNEW session_id
FIELDALIAS-msg_types   = msg_types ASNEW signature
EVAL-direction         = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product           = "Zeek"
EVAL-sensor_name       = coalesce(system_name, host, "unknown")
EVAL-transport         = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product    = "Zeek"
EVAL-src               = coalesce(src_ip, src_host)

[source::/nsm/zeek/logs/current/ntp.log]
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"
EVAL-mode_name       = case(mode==0, "Reserved", mode==1, "Symmetric Active", mode==2, "Symmetric Passive", mode==3, "Client", mode==4, "Server", mode==5, "Broadcast Server", mode==6, "Broadcast Client NTP control message", mode==7, "Reserved for private use")
EVAL-ntp_server      = case(mode==3, dest, mode==4, src, mode==5, src, mode==6, dest)
EVAL-ntp_client      = case(mode==3, src, mode==4, dest, mode==5, dest, mode==6, src)
EVAL-ntp_peer        = if(mode==1 OR mode==2, mvappend(src, dest), null())
EVAL-stratum_name    = case(stratum==0, "Unspecified or Invalid", stratum==1, "Primary server (e.g., equipped with a GPS receiver)", stratum>1 AND stratum<16, "Secondary server (via NTP)", stratum==16, "Unsynchronized", stratum>16 AND stratum<256, "Reserved", stratum>255, "Unknown")
EVAL-num_ext_error   = if(num_exts>0,"Error in num_exts: Extended fields could be used for malicious C2 traffic", null())
EVAL-poll_error      = case(poll<16, "Error in poll: Polling below spec requirement <16s", poll>131072, "Error in poll: Polling above spec requirement >36.4h")
EVAL-stratum_error   = if(stratum==0 OR stratum>16, "Error in stratum: " + stratum_name, null())
EVAL-version_error   = case(version==0, "Error in version: Version 0 RFC-959 is no longer supported by any other version", version>4,"Error in version: Exceeds Version 4 RFC-5905, the latest supported version - as of 2023")

[source::/nsm/zeek/logs/current/irc.log]
FIELDALIAS-value     = value AS signature
FIELDALIAS-addl      = addl AS description
FIELDALIAS-nick      = nick AS user
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/rdp.log]
FIELDALIAS-app       = security_protocol AS app
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"
EVAL-action          = case(result=="Success","success",result=="SSL_NOT_ALLOWED_BY_SERVER","failure",auth_success=="true","success",auth_success=="false","failure",1==1,"unknown")

[source::/nsm/zeek/logs/current/traceroute.log]
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/tunnel.log]
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/dpd.log]
FIELDALIAS-app            = analyzer AS app
FIELDALIAS-failure_reason = failure_reason AS signature
EVAL-direction            = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product              = "Zeek"
EVAL-sensor_name          = coalesce(system_name, host, "unknown")
EVAL-transport            = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product       = "Zeek"

[source::/nsm/zeek/logs/current/software.log]
SEDCMD-host-fix        = s/"host"/"host_header"/
FIELDALIAS-host_header = host_header AS src_host host_header AS tx_host
FIELDALIAS-host_p      = host_p AS src_port
FIELDALIAS-version     = version.major AS version_major version.minor AS version_minor version.minor2 AS version_patch
EVAL-direction         = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product           = "Zeek"
EVAL-sensor_name       = coalesce(system_name, host, "unknown")
EVAL-transport         = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product    = "Zeek"
EVAL-version           = if(isnotnull(version_major),version_major,"").if(isnotnull(version_minor),".".version_minor,"").if(isnotnull(version_minor2),".".version_minor2,"")

[source::/nsm/zeek/logs/current/weird.log]
EXTRACT-protocol     = ,\"source\":\"(?<protocol>[^\"]+)\"
FIELDALIAS-name      = name AS signature
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/notice.log]
FIELDALIAS-msg       = msg AS description
FIELDALIAS-file_desc = file_desc AS file_description
FIELDALIAS-fuid      = fuid AS file_id
FIELDALIAS-severity  = severity.level AS severity_id severity.name AS severity
FIELDALIAS-type      = note AS type note AS signature
FIELDALIAS-dst       = dst ASNEW dest_ip
FIELDALIAS-src       = src ASNEW src_ip
FIELDALIAS-p         = p ASNEW src_port
FIELDALIAS-actions   = actions{} ASNEW action actions ASNEW action
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/capture_loss.log]
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/reporter.log]
FIELDALIAS-message   = message AS description
FIELDALIAS-level     = level ASNEW signature
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"
EVAL-log_level       = mvindex(split(level,"::"),1)

[source::/nsm/zeek/logs/current/dce_rpc.log]
FIELDALIAS-rtt       = rtt ASNEW duration
FIELDALIAS-operation = operation AS message
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/analyzer.log]
FIELDALIAS-analyzer_name = analyzer_name ASNEW protocol
FIELDALIAS-fuid          = fuid AS file_id
EVAL-direction           = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product             = "Zeek"
EVAL-sensor_name         = coalesce(system_name, host, "unknown")
EVAL-transport           = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product      = "Zeek"
EVAL-signature           = analyzer_name.":".analyzer_kind.":".cause
EVAL-signature_id        = md5(analyzer_name.":".analyzer_kind.":".cause)
EVAL-type                = "alert"

[source::/nsm/zeek/logs/current/kerberos.log]
FIELDALIAS-error_msg = error_msg AS message
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"
EVAL-action          = if(success=="true","success","failure")

[source::/nsm/zeek/logs/current/ntlm.log]
FIELDALIAS-username                 = username ASNEW user username AS user_name
FIELDALIAS-domainname               = domainname AS domain
FIELDALIAS-server_dns_computer_name = server_dns_computer_name ASNEW dest_dns
FIELDALIAS-server_tree_name         = server_tree_name AS dest_nt_domain
EVAL-direction                      = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product                        = "Zeek"
EVAL-sensor_name                    = coalesce(system_name, host, "unknown")
EVAL-transport                      = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product                 = "Zeek"
EVAL-app                            = "ntlm"
EVAL-action                         = case(success=="T","success", isnotnull(success), "failure", isnotnull(action), action)

[source::/nsm/zeek/logs/current/smb_cmd.log]
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/snmp.log]
FIELDALIAS-snmp      = snmp AS rpc_protocol
FIELDALIAS-version   = version AS rpc_protocol_version
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/quic.log]
FIELDALIAS-version     = version ASNEW protocol_version
FIELDALIAS-server_name = server_name ASNEW dest_dns
EVAL-direction         = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product           = "Zeek"
EVAL-sensor_name       = coalesce(system_name, host, "unknown")
EVAL-transport         = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product    = "Zeek"

[source::/nsm/zeek/logs/current/smb_files.log]
EXTRACT-extract_file_path_root = ,\"path\":\"(?<file_path_root>[^\"]+)\",
FIELDALIAS-fuid                = fuid ASNEW file_id
FIELDALIAS-name                = name ASNEW file_name
FIELDALIAS-path                = path ASNEW file_path
FIELDALIAS-size                = size ASNEW file_size
FIELDALIAS-times_accessed      = times_accessed ASNEW file_access_time
FIELDALIAS-times_modified      = times_modified ASNEW file_modify_time
FIELDALIAS-times_changed       = times_changed ASNEW file_change_time
FIELDALIAS-times_created       = times_created ASNEW file_create_time
EVAL-direction                 = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product                   = "Zeek"
EVAL-sensor_name               = coalesce(system_name, host, "unknown")
EVAL-transport                 = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product            = "Zeek"

[source::/nsm/zeek/logs/current/smb_mapping.log]
EXTRACT-extract_file_path_root = ,\"path\":\"(?<file_path_root>[^\"]+)\",
FIELDALIAS-path                = path ASNEW file_path
FIELDALIAS-share_type          = share_type AS file_share_type
EVAL-direction                 = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product                   = "Zeek"
EVAL-sensor_name               = coalesce(system_name, host, "unknown")
EVAL-transport                 = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product            = "Zeek"

[source::/nsm/zeek/logs/current/known_certs.log]
EXTRACT-extract_ssl_issuer               = ,\"issuer_subject\":\"(?<ssl_issuer>[^\"]+)\",
EXTRACT-extract_ssl_issuer_common_name   = CN=(?<ssl_issuer_common_name>[^,]+) in ssl_issuer
EXTRACT-extract_ssl_issuer_country       = ,C=(?<ssl_issuer_country>[^,]+) in ssl_issuer
EXTRACT-extract_ssl_issuer_domain        = DC=(?<ssl_issuer_domain>[^,]+) in ssl_issuer
EXTRACT-extract_ssl_issuer_email         = emailAddress=(?<ssl_subject_email>[a-zA-Z0-9\.!#$%&'*+=?^`{|}~;_-]+@(?<ssl_subject_email_domain>[^,]+)) in ssl_issuer
EXTRACT-extract_ssl_issuer_locality      = L=(?<ssl_issuer_locality>[^,]+) in ssl_issuer
EXTRACT-extract_ssl_issuer_organization  = O=(?<ssl_issuer_organization>[^,]+) in ssl_issuer
EXTRACT-extract_ssl_issuer_state         = ST=(?<ssl_issuer_state>[^,]+) in ssl_issuer
EXTRACT-extract_ssl_issuer_unit          = OU=(?<ssl_issuer_unit>[^,]+) in ssl_issuer
EXTRACT-extract_ssl_name                 = title=(?<ssl_name>[^,]+) in ssl_issuer
EXTRACT-extract_ssl_subject              = ,\"subject\":\"(?<ssl_subject>[^\"]+)\",
EXTRACT-extract_ssl_subject_common_name  = CN=(?<ssl_subject_common_name>[^,]+) in ssl_subject
EXTRACT-extract_ssl_subject_country      = ,C=(?<ssl_subject_country>[^,]+) in ssl_subject
EXTRACT-extract_ssl_subject_domain       = DC=(?<ssl_subject_domain>[^,]+) in ssl_subject
EXTRACT-extract_ssl_subject_email        = emailAddress=(?<ssl_subject_email>[a-zA-Z0-9\.!#$%&'*+=?^`{|}~;_-]+@(?<ssl_subject_email_domain>[^,]+)) in ssl_subject
EXTRACT-extract_ssl_subject_locality     = L=(?<ssl_subject_locality>[^,]+) in ssl_subject
EXTRACT-extract_ssl_subject_name         = title=(?<ssl_name>[^,]+) in ssl_subject
EXTRACT-extract_ssl_subject_organization = O=(?<ssl_subject_organization>[^,]+) in ssl_subject
EXTRACT-extract_ssl_subject_state        = ST=(?<ssl_subject_state>[^,]+) in ssl_subject
EXTRACT-extract_ssl_subject_unit         = OU=(?<ssl_subject_unit>[^,]+) in ssl_subject
FIELDALIAS-hash                          = hash AS ssl_hash
FIELDALIAS-serial                        = serial AS ssl_serial
EVAL-direction                           = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product                             = "Zeek"
EVAL-sensor_name                         = coalesce(system_name, host, "unknown")
EVAL-transport                           = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product                      = "Zeek"

[source::/nsm/zeek/logs/current/known_hosts.log]
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"

[source::/nsm/zeek/logs/current/known_services.log]
FIELDALIAS-app       = service{} AS app
EVAL-direction       = case(isnotnull(direction),direction,local_orig="true" AND local_resp="true", "internal", local_orig="true" and local_resp="false", "outbound", local_orig="false" and local_resp="false", "external", local_orig="false" and local_resp="true", "inbound", 1=1, "unknown")
EVAL-product         = "Zeek"
EVAL-sensor_name     = coalesce(system_name, host, "unknown")
EVAL-transport       = if(proto=="icmp" and match('id.orig_h',".*:.*"),"icmp6", proto)
EVAL-vendor_product  = "Zeek"